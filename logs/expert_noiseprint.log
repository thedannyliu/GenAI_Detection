W0722 04:15:14.753000 1095114 site-packages/torch/distributed/run.py:766] 
W0722 04:15:14.753000 1095114 site-packages/torch/distributed/run.py:766] *****************************************
W0722 04:15:14.753000 1095114 site-packages/torch/distributed/run.py:766] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0722 04:15:14.753000 1095114 site-packages/torch/distributed/run.py:766] *****************************************
[Info] Train samples: 144024  Val samples: 1600
/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/open_clip/factory.py:388: UserWarning: These pretrained weights were trained with QuickGELU activation but the model config does not have that enabled. Consider using a model config with a "-quickgelu" suffix or enable with a flag.
  warnings.warn(
/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/open_clip/factory.py:388: UserWarning: These pretrained weights were trained with QuickGELU activation but the model config does not have that enabled. Consider using a model config with a "-quickgelu" suffix or enable with a flag.
  warnings.warn(
/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/open_clip/factory.py:388: UserWarning: These pretrained weights were trained with QuickGELU activation but the model config does not have that enabled. Consider using a model config with a "-quickgelu" suffix or enable with a flag.
  warnings.warn(
/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:132: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler=torch.cuda.amp.GradScaler()
/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:132: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler=torch.cuda.amp.GradScaler()
/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:132: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler=torch.cuda.amp.GradScaler()
Rank0 Epoch 0:   0%|          | 0/751 [00:00<?, ?it/s]/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:137: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:137: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py:137: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
[rank1]: Traceback (most recent call last):
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 196, in _run_module_as_main
[rank1]:     return _run_code(code, main_globals, None,
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 86, in _run_code
[rank1]:     exec(code, run_globals)
[rank1]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 232, in <module>
[rank1]:     train_one_expert(args)
[rank1]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 138, in train_one_expert
[rank1]:     logits = model(imgs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank1]:     return self._call_impl(*args, **kwargs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank1]:     return forward_call(*args, **kwargs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1637, in forward
[rank1]:     else self._run_ddp_forward(*inputs, **kwargs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1464, in _run_ddp_forward
[rank1]:     return self.module(*inputs, **kwargs)  # type: ignore[index]
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank1]:     return self._call_impl(*args, **kwargs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank1]:     return forward_call(*args, **kwargs)
[rank1]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/model.py", line 258, in forward
[rank1]:     patch_tok = self.experts[k](images)  # (B, L, d)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank1]:     return self._call_impl(*args, **kwargs)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank1]:     return forward_call(*args, **kwargs)
[rank1]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 162, in forward
[rank1]:     ll_feat = self._lowlevel_transform(images)  # (B,3,H,W)
[rank1]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 155, in _lowlevel_transform
[rank1]:     residual = F.conv2d(x, self.srm_kernel, padding=1, groups=3)
[rank1]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1940, in __getattr__
[rank1]:     raise AttributeError(
[rank1]: AttributeError: 'FrequencyExpert' object has no attribute 'srm_kernel'
Rank0 Epoch 0:   0%|          | 0/751 [00:01<?, ?it/s]
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 196, in _run_module_as_main
[rank0]:     return _run_code(code, main_globals, None,
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 86, in _run_code
[rank0]:     exec(code, run_globals)
[rank0]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 232, in <module>
[rank0]:     train_one_expert(args)
[rank0]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 138, in train_one_expert
[rank0]:     logits = model(imgs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1637, in forward
[rank0]:     else self._run_ddp_forward(*inputs, **kwargs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1464, in _run_ddp_forward
[rank0]:     return self.module(*inputs, **kwargs)  # type: ignore[index]
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/model.py", line 258, in forward
[rank0]:     patch_tok = self.experts[k](images)  # (B, L, d)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 162, in forward
[rank0]:     ll_feat = self._lowlevel_transform(images)  # (B,3,H,W)
[rank0]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 155, in _lowlevel_transform
[rank0]:     residual = F.conv2d(x, self.srm_kernel, padding=1, groups=3)
[rank0]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1940, in __getattr__
[rank0]:     raise AttributeError(
[rank0]: AttributeError: 'FrequencyExpert' object has no attribute 'srm_kernel'
[rank2]: Traceback (most recent call last):
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 196, in _run_module_as_main
[rank2]:     return _run_code(code, main_globals, None,
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/runpy.py", line 86, in _run_code
[rank2]:     exec(code, run_globals)
[rank2]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 232, in <module>
[rank2]:     train_one_expert(args)
[rank2]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/training/train_cvfid_expert.py", line 138, in train_one_expert
[rank2]:     logits = model(imgs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank2]:     return self._call_impl(*args, **kwargs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank2]:     return forward_call(*args, **kwargs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1637, in forward
[rank2]:     else self._run_ddp_forward(*inputs, **kwargs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/parallel/distributed.py", line 1464, in _run_ddp_forward
[rank2]:     return self.module(*inputs, **kwargs)  # type: ignore[index]
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank2]:     return self._call_impl(*args, **kwargs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank2]:     return forward_call(*args, **kwargs)
[rank2]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/model.py", line 258, in forward
[rank2]:     patch_tok = self.experts[k](images)  # (B, L, d)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
[rank2]:     return self._call_impl(*args, **kwargs)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
[rank2]:     return forward_call(*args, **kwargs)
[rank2]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 162, in forward
[rank2]:     ll_feat = self._lowlevel_transform(images)  # (B,3,H,W)
[rank2]:   File "/raid/dannyliu/GAI_Detection/GenAI_Detection/src/models/r_vfid/frequency_expert.py", line 155, in _lowlevel_transform
[rank2]:     residual = F.conv2d(x, self.srm_kernel, padding=1, groups=3)
[rank2]:   File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1940, in __getattr__
[rank2]:     raise AttributeError(
[rank2]: AttributeError: 'FrequencyExpert' object has no attribute 'srm_kernel'
[rank0]:[W722 04:15:31.438554121 ProcessGroupNCCL.cpp:1476] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
W0722 04:15:33.206000 1095114 site-packages/torch/distributed/elastic/multiprocessing/api.py:900] Sending process 1095216 closing signal SIGTERM
E0722 04:15:33.922000 1095114 site-packages/torch/distributed/elastic/multiprocessing/api.py:874] failed (exitcode: 1) local_rank: 0 (pid: 1095214) of binary: /home/liu/miniconda3/envs/GAIC/bin/python3.10
Traceback (most recent call last):
  File "/home/liu/miniconda3/envs/GAIC/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
  File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/distributed/run.py", line 892, in main
    run(args)
  File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/distributed/run.py", line 883, in run
    elastic_launch(
  File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 139, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/liu/miniconda3/envs/GAIC/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 270, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
src.training.train_cvfid_expert FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2025-07-22_04:15:33
  host      : DGX-Station-A100
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 1095215)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-07-22_04:15:33
  host      : DGX-Station-A100
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1095214)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
